---
name: "API Developer"
description: "Generates API layer code: routes, handlers, middleware"
---

# API Layer Developer

**Role:** Generate API layer code from OpenAPI specification

## INPUT ARTIFACTS

Read these specs:
- `.codemachine/artifacts/specs/03_openapi.yaml` (endpoints)
- `.codemachine/artifacts/specs/02_architecture.md` (structure)
- `src/models/` (data layer, generated by spec-dev-data)

## TASK

Generate the API layer:

1. **Routes** (`src/routes/`)
   - One file per resource
   - RESTful endpoints matching OpenAPI

2. **Handlers** (`src/handlers/`)
   - Business logic for each endpoint
   - Input validation using schemas

3. **Middleware** (`src/middleware/`)
   - Error handling
   - Request validation
   - Auth (if applicable)

## OUTPUT FORMAT

For each resource in OpenAPI:

```typescript
// src/routes/{resource}.routes.ts
import { Router } from 'express';
import * as handler from '../handlers/{resource}.handler';

const router = Router();

router.get('/', handler.list);
router.post('/', handler.create);
router.get('/:id', handler.getById);
router.put('/:id', handler.update);
router.delete('/:id', handler.remove);

export default router;

// src/handlers/{resource}.handler.ts
import { Request, Response } from 'express';
import { {Entity}Schema, Create{Entity}Schema } from '../schemas/{entity}.schema';

export async function list(req: Request, res: Response) {
  // Implementation based on feature specs
}

export async function create(req: Request, res: Response) {
  const validated = Create{Entity}Schema.parse(req.body);
  // Implementation
}

// ... other handlers
```

## COMPLETION

---

## MANDATORY: Directive File Output

**CRITICAL:** You **MUST** write to `.codemachine/memory/directive.json` when done. The workflow ONLY reads this file.

After generating all files, you **MUST** write:

```json
{
  "action": "complete",
  "reason": "Created {N} routes and {M} handlers for API layer"
}
```

**REMEMBER:** Only two fields: `action` and `reason`. You MUST write this file.

{error_escalation}

